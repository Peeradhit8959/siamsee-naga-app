<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÉ‡∏ö‡πÄ‡∏ã‡∏µ‡∏¢‡∏°‡∏ã‡∏µ‡∏≠‡∏á‡∏Ñ‡πå‡∏ô‡∏≤‡∏Ñ‡∏£‡∏≤‡∏ä</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');
        
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #FFFFFF;
            color: #111111;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        .loading {
            font-size: 1.2em;
            color: #6A0DAD;
        }
        .fortune-card {
            display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
            background-color: #FFFFFF;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            padding: 20px;
            background-color: #6A0DAD;
            color: #FFFFFF;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .body {
            padding: 20px;
            text-align: left;
        }
        .title-box {
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 2px solid #E6E6FA;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        .number-tag {
            background-color: #E6E6FA;
            color: #4B0082;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.2em;
        }
        .fortune-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #4B0082;
        }
        .detail-row {
            display: flex;
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        .detail-row .label {
            font-weight: bold;
            color: #6A0DAD;
            width: 120px;
            flex-shrink: 0;
        }
        .detail-row .value {
            color: #333333;
        }
        .advice {
            margin-top: 20px;
            border-top: 2px solid #E6E6FA;
            padding-top: 15px;
        }
        .advice .label {
            font-weight: bold;
            color: #4B0082;
        }
        .footer {
            padding: 20px;
        }
        button {
            font-family: 'Sarabun', sans-serif;
            background-color: #6A0DAD;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1em;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="loading-indicator" class="loading">
            <p>‡∏≠‡∏á‡∏Ñ‡πå‡∏ô‡∏≤‡∏Ñ‡∏£‡∏≤‡∏ä‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô‡∏û‡∏£...</p>
        </div>

        <div id="fortune-container" class="fortune-card">
            <div class="header">
                <h1 id="fortune-title"></h1>
            </div>
            <div class="body">
                <div class="title-box">
                    <div id="fortune-number" class="number-tag"></div>
                </div>

                <div class="detail-row">
                    <div class="label">‚ú® ‡∏ä‡∏∞‡∏ï‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</div>
                    <div id="fortune-main" class="value"></div>
                </div>
                <div class="detail-row">
                    <div class="label">üíº ‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</div>
                    <div id="fortune-work" class="value"></div>
                </div>
                <div class="detail-row">
                    <div class="label">üí∞ ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</div>
                    <div id="fortune-finance" class="value"></div>
                </div>
                <div class="detail-row">
                    <div class="label">‚ù§Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å</div>
                    <div id="fortune-love" class="value"></div>
                </div>
                <div class="detail-row">
                    <div class="label">üí™ ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</div>
                    <div id="fortune-health" class="value"></div>
                </div>
                 <div class="detail-row">
                    <div class="label">üíé ‡πÄ‡∏•‡∏Ç‡∏°‡∏á‡∏Ñ‡∏•</div>
                    <div id="fortune-lucky" class="value"></div>
                </div>

                <div class="advice">
                    <div class="label">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å‡∏≠‡∏á‡∏Ñ‡πå‡∏ô‡∏≤‡∏Ñ‡∏£‡∏≤‡∏ä</div>
                    <p id="fortune-advice" class="value"></p>
                </div>
            </div>
            <div class="footer">
                <button onclick="retry()">‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏ã‡∏µ‡∏¢‡∏°‡∏ã‡∏µ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
            </div>
        </div>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        window.onload = function() {
            liff.init({ liffId: "2007499712-ljGY76Pk" }) // <-- ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                .then(() => {
                    fetchFortuneData();
                })
                .catch((err) => {
                    console.error(err);
                    document.getElementById("loading-indicator").innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î LIFF App";
                });
        };

        function fetchFortuneData() {
            google.script.run
                .withSuccessHandler(displayFortune)
                .withFailureHandler(displayError)
                .generateFortuneWithAI(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ù‡∏±‡πà‡∏á Server
        }

        function displayFortune(data) {
            if (data) {
                document.getElementById("fortune-number").innerText = `‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${data['‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà']}`;
                document.getElementById("fortune-title").innerText = data['‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ö‡πÄ‡∏ã‡∏µ‡∏¢‡∏°‡∏ã‡∏µ'];
                document.getElementById("fortune-main").innerText = data['‡∏ä‡∏∞‡∏ï‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'];
                document.getElementById("fortune-work").innerText = data['‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô'];
                document.getElementById("fortune-finance").innerText = data['‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô'];
                document.getElementById("fortune-love").innerText = data['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å'];
                document.getElementById("fortune-health").innerText = data['‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û'];
                document.getElementById("fortune-lucky").innerText = data['‡πÄ‡∏•‡∏Ç‡∏°‡∏á‡∏Ñ‡∏•'];
                document.getElementById("fortune-advice").innerText = data['‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥'];
                
                // ‡∏ã‡πà‡∏≠‡∏ô loading ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î
                document.getElementById("loading-indicator").style.display = 'none';
                document.getElementById("fortune-container").style.display = 'block';
            } else {
                displayError();
            }
        }

        function displayError() {
            document.getElementById("loading-indicator").innerText = "‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ";
        }

        function retry() {
            // ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
            window.location.reload();
        }
    </script>
</body>
</html>
